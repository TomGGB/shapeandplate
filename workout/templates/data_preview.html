{% extends "base.html" %}
{% load static %}
{% block title %}Rutina generada{% endblock %}
{% block content %}
<div class="top-app-bar">
    <span class="material-icons" style="vertical-align: middle; font-size: 24px;">fitness_center</span>
    <h1 style="display: inline; vertical-align: middle;">Rutinas de Ejercicios</h1>
</div>
<div class="card-container">
    {% for routine in exercise_routines %}
        {% for ejercicio in routine.routine.rutina %}
            <div class="card">
                <span class="difficulty">Dificultad: </span>
                <span class="difficulty {% if ejercicio.i == 'Baja' %}beginner{% elif ejercicio.i == 'Media' %}intermediate{% else %}advanced{% endif %}">{{ ejercicio.i }}</span>
                <h2>{{ ejercicio.nombre }}</h2>
                <p>{{ ejercicio.desc }}</p>
                <ul>
                    {% if ejercicio.duracion %}
                        <li><i class="material-icons" style="vertical-align: middle; font-size: 20px;">schedule</i> Duración: {{ ejercicio.duracion }}</li>
                    {% endif %}
                    {% if ejercicio.rep %}
                        <li><i class="material-icons" style="vertical-align: middle; font-size: 20px;">replay</i> Repeticiones: {{ ejercicio.rep }}</li>
                    {% endif %}
                    {% if ejercicio.series %}
                        <li><i class="material-icons" style="vertical-align: middle; font-size: 20px;">replay</i> Series: {{ ejercicio.series }}</li>
                    {% endif %}
                    {% if ejercicio.sesiones %}
                        <li><i class="material-icons" style="vertical-align: middle; font-size: 20px;">fitness_center</i> Sesiones: {{ ejercicio.sesiones }}</li>
                    {% endif %}
                </ul>
            </div>
        {% endfor %}
    {% endfor %}
</div>

<!-- Botón flotante -->
<button class="floating-button material-symbols-outlined" id="delete-routine-button" style="vertical-align: middle; font-size: 24px;">
    monitor_weight_gain
</button>

<!-- Modal de confirmación -->
<div id="confirmation-modal" class="modal">
    <div class="modal-content">
        <span class="close-button">&times;</span>
        <h2>Confirmación</h2>
        <p>¿Estás seguro de que deseas generar una rutina nueva con nuevos datos?</p>
        <button id="confirm-delete-button" class="confirm-button">Generar</button>
        <button id="cancel-button" class="cancel-button">Cancelar</button>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const deleteButton = document.getElementById('delete-routine-button');
        const modal = document.getElementById('confirmation-modal');
        const closeButton = document.querySelector('.close-button');
        const confirmDeleteButton = document.getElementById('confirm-delete-button');
        const cancelButton = document.getElementById('cancel-button');

        // Abrir el modal
        deleteButton.addEventListener('click', () => {
            modal.style.display = 'block';
        });

        // Cerrar el modal
        closeButton.addEventListener('click', () => {
            modal.style.display = 'none';
        });

        cancelButton.addEventListener('click', () => {
            modal.style.display = 'none';
        });

        // Cerrar el modal al hacer clic fuera del contenido del modal
        window.addEventListener('click', (event) => {
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        });

        // Confirmar eliminación
        confirmDeleteButton.addEventListener('click', () => {
            fetch("{% url 'delete_routine' %}", {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                body: JSON.stringify({ user_id: '{{ user.id }}' })
            })
            .then(response => {
                if (response.ok) {
                    window.location.href = "{% url 'workout' %}";
                } else {
                    alert('Error al eliminar la rutina.');
                }
            });
        });
    });
</script>
{% endblock %}