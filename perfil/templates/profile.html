{% extends "base.html" %}
{% load static %}

{% block title %}Perfil de {{ first_name }}{% endblock %}

{% block page_title %}
    <span class="material-icons">manage_accounts</span>
    <h1>Perfil de {{ first_name }}</h1>
{% endblock %}

{% block content %}
<div id="profile-content" class="card">
    <div class="flex items-center justify-between mb-6">
        <button class="theme-toggle bg-gray-800 text-white p-2 rounded-full" onclick="toggleTheme()">
            <i class="fa fa-adjust"></i>
        </button>
        <h1 class="text-center text-2xl font-bold flex-grow"></h1>
        <a href="{% url 'logout' %}" class="logout-button bg-gray-800 text-white p-2 rounded-full">
            <i class="fa fa-sign-out-alt"></i>
        </a>
    </div>
    <div id="profile-data">
        <ul>
            <li><strong>Nombre:</strong> {{ first_name|default_if_none:"No registrado" }}</li>
            <li><strong>Apellidos:</strong> {{ last_name|default_if_none:"No registrado" }}</li>
            <li><strong>Correo Electrónico:</strong> {{ email|default_if_none:"No registrado" }}</li>
            <li><strong>Tipo de dieta:</strong> {% if diet == 'omnivora' %}Omnívora{% elif diet == 'vegana' %}Vegana{% elif diet == 'vegetariana' %}Vegetariana{% elif diet == 'paleo' %}Paleo{% elif diet == 'cetogenica' %}Cetogénica{% else %}No registrado{% endif %}</li>
            <li><strong>Peso (kg):</strong> {% if weight and weight != 0 %}{{ weight|floatformat:0 }}{% else %}No registrado{% endif %}</li>
            <li><strong>Altura (cm):</strong> {% if height and height != 0 %}{{ height|floatformat:0 }}{% else %}No registrado{% endif %}</li>
            <li><strong>IMC:</strong> {% if imc and imc != 0 %}{{ imc }}{% else %}No registrado{% endif %}</li>
            <li><strong>¿Fumador?:</strong> {% if smoker == True %}Si{% elif smoker == False %}No{% else %}No registrado{% endif %}</li>
            <li><strong>Horas de ejercicio semanal:</strong> {% if weekly_exercise_hours and weekly_exercise_hours != 0 %}{{ weekly_exercise_hours }}{% else %}No registrado{% endif %}</li>
            <li><strong>Objetivo:</strong> {% if goal == 'ganar_peso' %}Ganar Peso{% elif goal == 'ganar_musculatura' %}Ganar Musculatura{% elif goal == 'perder_peso' %}Perder Peso{% elif goal == 'mantener_peso' %}Mantener Peso{% elif goal == 'mejorar_condicion_fisica' %}Mejorar Condición Física{% else %}No registrado{% endif %}</li>
            <li><strong>¿Acceso a gimnasio?:</strong> {% if gym_access == True %}Si{% elif gym_access == False %}No{% else %}No registrado{% endif %}</li>
        </ul>
    </div>
    <!-- Botón flotante -->
    <button id="edit-button" class="floating-button material-symbols-outlined">
        edit
    </button>
</div>

<!-- Modal -->
<div id="edit-modal" class="modal card">
    <div class="modal-content">
        <span class="close-button">&times;</span>
        <h2>Editar Perfil</h2>
        <form id="edit-profile-form" method="post" action="{% url 'profile' %}">
            {% csrf_token %}
            <label for="first_name" class="block mt-4">Nombre:</label>
            <input type="text" id="first_name" name="first_name" value="{{ first_name|default_if_none:0 }}" required class="w-full p-2 mt-1 border border-gray-300 rounded-md">
            
            <label for="last_name" class="block mt-4">Apellidos:</label>
            <input type="text" id="last_name" name="last_name" value="{{ last_name|default_if_none:0 }}" required class="w-full p-2 mt-1 border border-gray-300 rounded-md">

            <label for="diet" class="block mt-4">Tipo de dieta:</label>
            <select id="diet" name="diet" class="w-full p-2 mt-1 border border-gray-300 rounded-md">
                <option value="omnivora" {% if diet == 'omnivora' %}selected{% endif %}>Omnívora</option>
                <option value="vegana" {% if diet == 'vegana' %}selected{% endif %}>Vegana</option>
                <option value="vegetariana" {% if diet == 'vegetariana' %}selected{% endif %}>Vegetariana</option>
                <option value="paleo" {% if diet == 'paleo' %}selected{% endif %}>Paleo</option>
                <option value="cetogenica" {% if diet == 'cetogenica' %}selected{% endif %}>Cetogénica</option>
            </select>

            <label for="weight" class="block mt-4">Peso (kg):</label>
            <input type="number" step="0.01" id="weight" name="weight" value="{{ weight|default_if_none:0 }}" class="w-full p-2 mt-1 border border-gray-300 rounded-md">

            <label for="height" class="block mt-4">Altura (cm):</label>
            <input type="number" step="0.01" id="height" name="height" value="{{ height|default_if_none:0 }}" class="w-full p-2 mt-1 border border-gray-300 rounded-md">

            <label for="imc" class="block mt-4">IMC:</label>
            <input type="float" id="imc" name="imc" value="{% if imc %}{{ imc }}{% else %}0{% endif %}" readonly class="w-full p-2 mt-1 border border-gray-300 rounded-md">

            <div class="form-group mt-4">
                <label for="smoker" class="block">¿Fumador?</label>
                <div class="toggle-switch mt-2">
                    <input type="checkbox" id="smoker" name="smoker" {% if smoker %}checked{% endif %}>
                    <label for="smoker"></label>
                </div>
            </div>

            <label for="weekly_exercise_hours" class="block mt-4">Horas de ejercicio semanal:</label>
            <input type="number" step="0.01" id="weekly_exercise_hours" name="weekly_exercise_hours" value="{{ weekly_exercise_hours|default_if_none:0 }}" class="w-full p-2 mt-1 border border-gray-300 rounded-md">

            <label for="goal" class="block mt-4">Objetivo:</label>
            <select id="goal" name="goal" class="w-full p-2 mt-1 border border-gray-300 rounded-md">
                <option value="" {% if goal == None %}selected{% endif %}></option>
                <option value="ganar_peso" {% if goal == 'ganar_peso' %}selected{% endif %}>Ganar Peso</option>
                <option value="ganar_musculatura" {% if goal == 'ganar_musculatura' %}selected{% endif %}>Ganar Musculatura</option>
                <option value="perder_peso" {% if goal == 'perder_peso' %}selected{% endif %}>Perder Peso</option>
                <option value="mantener_peso" {% if goal == 'mantener_peso' %}selected{% endif %}>Mantener Peso</option>
                <option value="mejorar_condicion_fisica" {% if goal == 'mejorar_condicion_fisica' %}selected{% endif %}>Mejorar Condición Física</option>
            </select>

            <div class="form-group mt-4">
                <label for="gym_access" class="block">¿Acceso a gimnasio?</label>
                <div class="toggle-switch mt-2">
                    <input type="checkbox" id="gym_access" name="gym_access" {% if gym_access %}checked{% endif %}>
                    <label for="gym_access"></label>
                </div>
            </div>

            <input type="submit" value="Guardar" class="w-full mt-6 p-2 bg-primary text-primary-foreground rounded-md cursor-pointer hover:bg-primary-foreground hover:text-primary">
        </form>
    </div>
</div>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const alturaInput = document.getElementById('height');
        const pesoInput = document.getElementById('weight');
        const imcInput = document.getElementById('imc');
        const goalSelect = document.getElementById('goal');

        function calcularIMC() {
            const altura = parseFloat(alturaInput.value) / 100; // Convertir cm a metros
            const peso = parseFloat(pesoInput.value);
            if (!isNaN(altura) && !isNaN(peso) && altura > 0) {
                const imc = (peso / (altura * altura)).toFixed(2);
                imcInput.value = imc;
            } else {
                imcInput.value = '';
            }
        }

        alturaInput.addEventListener('input', calcularIMC);
        pesoInput.addEventListener('input', calcularIMC);

        // Obtener elementos del modal
        const editButton = document.getElementById('edit-button');
        const modal = document.getElementById('edit-modal');
        const closeButton = document.querySelector('.close-button');

        // Abrir el modal
        editButton.addEventListener('click', () => {
            modal.style.display = 'block';
            // Establecer valores predeterminados si no hay datos
            if (!alturaInput.value) alturaInput.value = 0;
            if (!pesoInput.value) pesoInput.value = 0;
            if (!goalSelect.value) goalSelect.value = '';
        });

        // Cerrar el modal
        closeButton.addEventListener('click', () => {
            modal.style.display = 'none';
        });

        // Cerrar el modal al hacer clic fuera del contenido del modal
        window.addEventListener('click', (event) => {
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        });
    });
</script>
{% endblock %}

{% block extra_css %}
<style>
    /* ... Otros estilos ... */

    .toggle-switch {
        position: relative;
        display: inline-block;
        width: 60px;
        height: 34px;
    }

    .toggle-switch input {
        opacity: 0;
        width: 0;
        height: 0;
    }

    .toggle-switch label {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: .4s;
        border-radius: 34px;
    }

    .toggle-switch label:before {
        position: absolute;
        content: "";
        height: 26px;
        width: 26px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        transition: .4s;
        border-radius: 50%;
    }

    .toggle-switch input:checked + label {
        background-color: var(--primary-color);
    }

    .toggle-switch input:checked + label:before {
        transform: translateX(26px);
    }

    /* Ajuste para centrar la bolita del switch */
    .toggle-switch label:before {
        top: 50%;
        transform: translateY(-50%);
    }

    .toggle-switch input:checked + label:before {
        transform: translate(26px, -50%);
    }
</style>
{% endblock %}