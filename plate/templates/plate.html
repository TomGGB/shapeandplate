{% extends "base.html" %}
{% load static %}
{% block title %}Recetas Personalizadas{% endblock %}
{% block content %}
<div class="top-app-bar">
    <span class="material-icons" style="vertical-align: middle; font-size: 24px;">menu_book</span>
    <h1 style="display: inline; vertical-align: middle;">Recetas Personalizadas</h1>
</div>
{% if recetas_por_dia %}
<div class="card-container">
    <div class="card">
        <h2>¡Recuerda!</h2>
        <p>Las recetas se actualizan cada vez que generas una nueva rutina de ejercicios ya que se adaptan a tus necesidades nutricionales.</p>
        <p>¡No olvides revisarlas!</p>
    </div>
</div>
<div class="card-container">
    {% for dia, recetas_dia in recetas_por_dia.items %}
        <div class="day-card">
            <h2 class="day-title" >{{ dia }}</h2>
            {% for receta in recetas_dia %}
                <div class="accordion">
                    <div class="accordion-header" onclick="toggleAccordion(this)">
                        <h3>{{ receta.nombre }}</h3>
                    </div>
                    <div class="accordion-content">
                        <p class="description">{{ receta.desc }}</p>
                        <ul class="details">
                            <li><strong>Tiempo de preparación:</strong> {{ receta.tiempo }}</li>
                            <li><strong>Dificultad:</strong> {{ receta.dificultad }}</li>
                        </ul><br>
                        <div class="ingredients">
                            <strong>Ingredientes:</strong>
                            <ul>
                                {% for ingrediente in receta.ingredientes %}
                                    <li>{{ ingrediente }}</li>
                                {% endfor %}
                            </ul>
                        </div><br>
                        <div class="instructions">
                            <strong>Instrucciones:</strong>
                            <ol>
                                {% for paso in receta.instrucciones %}
                                    <li>{{ paso }}</li>
                                {% endfor %}
                            </ol>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% endfor %}
</div>

<script>
    function toggleAccordion(element) {
        const accordion = element.parentElement;
        const content = element.nextElementSibling;
        const isOpen = content.style.display === 'block';

        // Cerrar cualquier otro acordeón abierto
        const allAccordions = document.querySelectorAll('.accordion-content');
        allAccordions.forEach(function(acc) {
            if (acc !== content) {
                acc.style.display = 'none';
                acc.parentElement.classList.remove('open');
            }
        });

        // Alternar el estado del acordeón actual
        content.style.display = isOpen ? 'none' : 'block';
        if (isOpen) {
            accordion.classList.remove('open');
        } else {
            accordion.classList.add('open');
        }
    }
</script>
{% endif %}
<button class="floating-button material-symbols-outlined" id="delete-routine-button" onclick="document.getElementById('confirmation-modal').style.display='block'">
    local_dining
</button>

<!-- Modal de confirmación -->
<div id="confirmation-modal" class="modal">
    <div class="modal-content">
        <span class="close-button" onclick="document.getElementById('confirmation-modal').style.display='none'">&times;</span>
        <h2>Confirmación</h2>
        <p>¿Estás seguro de que deseas generar nuevas recetas?</p>
        <form method="post" action="{% url 'delete_recipe' %}">
            {% csrf_token %}
            <button type="submit" class="confirm-button">Generar</button>
            <button type="button" class="cancel-button" onclick="document.getElementById('confirmation-modal').style.display='none'">Cancelar</button>
        </form>
    </div>
</div>
{% endblock %}